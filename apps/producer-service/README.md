# Producer Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ Apache Kafka —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Clean Architecture –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ Go —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤ Kafka —Å retry –ª–æ–≥–∏–∫–æ–π
- üìä Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üîç –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Logrus
- üõ°Ô∏è Graceful shutdown –∏ recovery middleware
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- üèóÔ∏è Clean Architecture —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤
- üê≥ Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- üìà Health checks –∏ readiness probes

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture:

```
cmd/server/          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
internal/
‚îú‚îÄ‚îÄ domain/          # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ usecase/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ infrastructure/  # –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Kafka, –º–µ—Ç—Ä–∏–∫–∏)
‚îú‚îÄ‚îÄ delivery/        # HTTP handlers –∏ middleware
‚îî‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## API Endpoints

### –°–æ–±—ã—Ç–∏—è

- `POST /api/v1/events/user` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/events/order` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫–∞–∑–∞  
- `POST /api/v1/events/payment` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–ª–∞—Ç–µ–∂–∞
- `GET /api/v1/events/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π

### –°–∏—Å—Ç–µ–º–Ω—ã–µ

- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /ready` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
- `GET /metrics` - Prometheus –º–µ—Ç—Ä–∏–∫–∏ (–ø–æ—Ä—Ç 9090)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### –°–µ—Ä–≤–µ—Ä
- `SERVER_ADDRESS` - –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `:8080`)
- `SERVER_READ_TIMEOUT` - –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `15s`)
- `SERVER_WRITE_TIMEOUT` - –¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `15s`)
- `SERVER_SHUTDOWN_TIMEOUT` - –¢–∞–π–º–∞—É—Ç graceful shutdown (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `30s`)

### Kafka
- `KAFKA_BROKER_LIST` - –°–ø–∏—Å–æ–∫ –±—Ä–æ–∫–µ—Ä–æ–≤ Kafka (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `localhost:9092`)
- `KAFKA_TOPIC` - –¢–æ–ø–∏–∫ –¥–ª—è —Å–æ–±—ã—Ç–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `events`)
- `KAFKA_CLIENT_ID` - ID –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `producer-service`)
- `KAFKA_BATCH_SIZE` - –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `100`)
- `KAFKA_MAX_RETRIES` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `3`)
- `KAFKA_COMPRESSION` - –¢–∏–ø —Å–∂–∞—Ç–∏—è: `none`, `gzip`, `snappy`, `lz4`, `zstd` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `snappy`)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `LOG_LEVEL` - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `debug`, `info`, `warn`, `error` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `info`)
- `LOG_FORMAT` - –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤: `json`, `text` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `json`)

### –ú–µ—Ç—Ä–∏–∫–∏
- `METRICS_ENABLED` - –í–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `true`)
- `METRICS_PORT` - –ü–æ—Ä—Ç –¥–ª—è –º–µ—Ç—Ä–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `:9090`)

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `APP_NAME` - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `producer-service`)
- `APP_VERSION` - –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `1.0.0`)
- `APP_ENV` - –û–∫—Ä—É–∂–µ–Ω–∏–µ: `development`, `staging`, `production` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `development`)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
make deps
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Kafka –∏ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
make compose-up
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
make run
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker

1. –°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
```bash
make docker-build
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
make docker-run
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost:8080/api/v1/events/user \
  -H "Content-Type: application/json" \
  -d '{"data": "{\"user_id\": \"123\", \"email\": \"user@example.com\"}"}'
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫–∞–∑–∞

```bash
curl -X POST http://localhost:8080/api/v1/events/order \
  -H "Content-Type: application/json" \
  -d '{"data": "{\"order_id\": \"456\", \"amount\": 100.50}"}'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```bash
curl http://localhost:8080/api/v1/events/stats
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ö–æ–º–∞–Ω–¥—ã Makefile

```bash
make help           # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make build          # –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
make test           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make test-coverage  # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make lint           # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä
make fmt            # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
make clean          # –û—á–∏—Å—Ç–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–±–æ—Ä–∫–∏
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage

# –ë–µ–Ω—á–º–∞—Ä–∫–∏
make bench

# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make load-test
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
make health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
make ready

# –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫
make metrics
```

## –ú–µ—Ç—Ä–∏–∫–∏

–°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ Prometheus –º–µ—Ç—Ä–∏–∫–∏:

### HTTP –º–µ—Ç—Ä–∏–∫–∏
- `http_requests_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### Producer –º–µ—Ç—Ä–∏–∫–∏
- `producer_events_published_total` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- `producer_events_failed_total` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- `producer_publish_duration_seconds` - –í—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- `producer_batch_size` - –†–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π —Å–æ–±—ã—Ç–∏–π

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

```json
{
  "level": "info",
  "msg": "Event published successfully",
  "event_id": "user_created_20240101120000_abc123",
  "event_type": "user_created",
  "duration": "15.2ms",
  "time": "2024-01-01T12:00:00Z"
}
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker Compose

–°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ–±—â–∏–π docker-compose.yaml –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f producer-service
```

### Kubernetes

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ Kubernetes –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `k8s/`.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ó–∞—â–∏—Ç–∞ –æ—Ç CORS –∞—Ç–∞–∫
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- Graceful shutdown –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
- Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ë–∞—Ç—á–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- –°–∂–∞—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π Kafka (snappy –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- Connection pooling –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å goroutines

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∞–ª–µ—Ä—Ç—ã:

- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Kafka –±—Ä–æ–∫–µ—Ä–æ–≤
- –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏/CPU

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
